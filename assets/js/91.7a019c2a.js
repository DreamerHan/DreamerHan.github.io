(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{559:function(s,t,a){"use strict";a.r(t);var n=a(54),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"pm2-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2-配置文件"}},[s._v("#")]),s._v(" PM2 配置文件")]),s._v(" "),a("h2",{attrs:{id:"配置内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置内容"}},[s._v("#")]),s._v(" 配置内容")]),s._v(" "),a("p",[s._v("根目录创建配置文件 "),a("code",[s._v("pm2.conf.json")]),s._v("，内容如下：")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"apps"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pm2-test-server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 服务名称")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 相对执行命令，启动脚本的路径信息")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否监听文件改变")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ignore_watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 忽略监听的文件")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"error_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs/err.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 错误日志输出文件,不配置时通过 pm2.info 查看")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"out_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs/out.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 访问日志输出文件，不配置时通过 pm2.info 查看")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"log_date_format"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YYYY-MM-DD HH:mm:ss"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 日志输出时间格式")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"服务启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务启动"}},[s._v("#")]),s._v(" 服务启动")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[a("strong",[s._v("启动指令："),a("code",[s._v("pm2 start 配置文件路径信息")])])])]),s._v(" "),a("p",[s._v("该目录启动模式 "),a("code",[s._v("pm2 start pm2.conf.json")]),s._v(" 即可，主要注意最后一列的 "),a("code",[s._v("watching")]),s._v(" 此时是 "),a("code",[s._v("enabled")]),s._v("，这是配置文件中的 "),a("code",[s._v("watch")]),s._v(" 的表现。")]),s._v(" "),a("p",[s._v("第一次启动后，进程列表是这样子的：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌─────┬────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐\n│ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("  │ name   │ namespace   │ version │ mode    │ pid      │ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v(" │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │\n├─────┼────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   │ app    │ default     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0   │ fork    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29788")]),s._v("    │ 0s     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    │ online    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%       │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".7mb    │ han… │ enabled  │\n└─────┴────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘\n")])])]),a("p",[s._v("修改 "),a("code",[s._v("app.js")]),s._v(" 的内容后，再次 "),a("code",[s._v("pm2 list")]),s._v(" 查看，可以发现 "),a("strong",[s._v("↺")]),s._v(" 重启了，这就是文件变化了会监听重启服务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌─────┬────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐\n│ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("  │ name   │ namespace   │ version │ mode    │ pid      │ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v(" │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │\n├─────┼────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   │ app    │ default     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0   │ fork    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29824")]),s._v("    │ 10s    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    │ online    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%       │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(".9mb   │ han… │ enabled  │\n└─────┴────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘\n")])])]),a("p",[s._v("还有一个重启的体现就是访问日志 "),a("code",[s._v("logs/out.log")]),s._v(" 的表现：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Server is running at port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Current time is  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1644067349845")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Current time is  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1644067350179")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Server is running at port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 发生了服务重启")]),s._v("\n")])])]),a("h2",{attrs:{id:"当前目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#当前目录"}},[s._v("#")]),s._v(" 当前目录")]),s._v(" "),a("p",[s._v("注意，目录的结构决定了上述指令的书写方式，很重要。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  ├── app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n  ├── logs\n  │   ├── err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 错误日志")]),s._v("\n  │   └── out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 访问日志")]),s._v("\n  ├── "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n  └── pm2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 配置文件")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);