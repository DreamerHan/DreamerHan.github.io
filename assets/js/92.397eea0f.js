(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{557:function(s,t,a){"use strict";a.r(t);var n=a(54),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"多进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多进程"}},[s._v("#")]),s._v(" 多进程")]),s._v(" "),a("p",[s._v("多进程是除了 "),a("strong",[s._v("守护进程")]),s._v(" 外，pm2 的另一个核心价值。")]),s._v(" "),a("h2",{attrs:{id:"为什么要用多进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用多进程"}},[s._v("#")]),s._v(" 为什么要用多进程")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("从"),a("strong",[s._v("内存")]),s._v("来说：由于操作系统中同时会有多个进程的存在，而操作系统分配给每个进程的内存是有一定限制的。比如，nodeJS 的进程在 32 位的操作系统中内存只分配了 "),a("code",[s._v("1.6G")]),s._v("。但是如果此时机器的内存特别大，只能占用 "),a("code",[s._v("1.6G")]),s._v("就是一种赤裸裸的浪费。所以多进程可以实现内存的最大化使用。")])]),s._v(" "),a("li",[a("p",[s._v("从"),a("strong",[s._v("CPU")]),s._v("来说：4 核 CPU 就是可以同时处理 4 个进程的工作。于是乎，CPU 核数越多，处理事物的速度也就越快。使用多进程就可以最大化使用 CPU 资源")])])]),s._v(" "),a("h2",{attrs:{id:"有哪些问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#有哪些问题"}},[s._v("#")]),s._v(" 有哪些问题")]),s._v(" "),a("p",[s._v("多进程之间的内存是不共享的，比如你存在当前进程中的 "),a("code",[s._v("session 数据")]),s._v(" 就是互相之间不同的。于是有了 "),a("code",[s._v("redis")]),s._v(" 服务来解决多进程的存储问题。")]),s._v(" "),a("h2",{attrs:{id:"配置文件添加多进程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件添加多进程"}},[s._v("#")]),s._v(" 配置文件添加多进程")]),s._v(" "),a("div",{staticClass:"language-json extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"apps"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"names"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pm2-test-server"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"script"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"instances"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置服务进程数")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ignore_watch"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node_modules"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"error_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs/err.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"out_file"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logs/out.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"log_date_format"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YYYY-MM-DD HH:mm:ss"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("启动服务后，可以看到进程数列表如下，有四个进程：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌─────┬────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐\n│ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("  │ name   │ namespace   │ version │ mode    │ pid      │ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v(" │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │\n├─────┼────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   │ app    │ default     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0   │ cluster │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31134")]),s._v("    │ 0s     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    │ online    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%       │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(".1mb   │ han… │ enabled  │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   │ app    │ default     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0   │ cluster │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31135")]),s._v("    │ 0s     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    │ online    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%       │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".7mb   │ han… │ enabled  │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   │ app    │ default     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0   │ cluster │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31136")]),s._v("    │ 0s     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    │ online    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%       │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".7mb   │ han… │ enabled  │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("   │ app    │ default     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0   │ cluster │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31137")]),s._v("    │ 0s     │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    │ online    │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%       │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(".2mb   │ han… │ enabled  │\n└─────┴────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘\n")])])]),a("p",[s._v("开启四个进程，产生的日志目录也会变成多个，多次访问后会发现，每个日志的记录数据可能是不同的。这是因为开启多进程后，"),a("code",[s._v("pm2")]),s._v(" 也开启了负载均衡")]),s._v(" "),a("h2",{attrs:{id:"当前目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#当前目录"}},[s._v("#")]),s._v(" 当前目录")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  ├── app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n  ├── logs\n  │   ├── err"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.")]),s._v("log\n  │   ├── err"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("log\n  │   ├── err"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("log\n  │   ├── err"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("log\n  │   ├── err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n  │   ├── out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.")]),s._v("log\n  │   ├── out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("log\n  │   ├── out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("log\n  │   ├── out"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("log\n  │   └── out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n  ├── "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n  └── pm2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);