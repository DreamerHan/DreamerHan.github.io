<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JWT 疑惑记录 | 行也安然，坐也安然</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="韩志臻的blog">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.a86fb578.js" as="script"><link rel="preload" href="/assets/js/2.f4c76e8f.js" as="script"><link rel="preload" href="/assets/js/5.7803e6c7.js" as="script"><link rel="prefetch" href="/assets/js/10.c61de724.js"><link rel="prefetch" href="/assets/js/100.4d2d0254.js"><link rel="prefetch" href="/assets/js/11.5946abfa.js"><link rel="prefetch" href="/assets/js/12.f35e3c14.js"><link rel="prefetch" href="/assets/js/13.b07a3d91.js"><link rel="prefetch" href="/assets/js/14.bce4ea6a.js"><link rel="prefetch" href="/assets/js/15.22ab3510.js"><link rel="prefetch" href="/assets/js/16.532528f4.js"><link rel="prefetch" href="/assets/js/17.6547aa4e.js"><link rel="prefetch" href="/assets/js/18.fccb4247.js"><link rel="prefetch" href="/assets/js/19.cf7baf86.js"><link rel="prefetch" href="/assets/js/20.80bddd98.js"><link rel="prefetch" href="/assets/js/21.9dd6f94b.js"><link rel="prefetch" href="/assets/js/22.df40fa6b.js"><link rel="prefetch" href="/assets/js/23.d381164b.js"><link rel="prefetch" href="/assets/js/24.23eccce1.js"><link rel="prefetch" href="/assets/js/25.675a5dd3.js"><link rel="prefetch" href="/assets/js/26.134e7b03.js"><link rel="prefetch" href="/assets/js/27.44100860.js"><link rel="prefetch" href="/assets/js/28.51c5575c.js"><link rel="prefetch" href="/assets/js/29.2bb6682f.js"><link rel="prefetch" href="/assets/js/3.dc71286f.js"><link rel="prefetch" href="/assets/js/30.675b9b1e.js"><link rel="prefetch" href="/assets/js/31.12bfff40.js"><link rel="prefetch" href="/assets/js/32.c6ed9587.js"><link rel="prefetch" href="/assets/js/33.5dd439a5.js"><link rel="prefetch" href="/assets/js/34.0d93fa0b.js"><link rel="prefetch" href="/assets/js/35.f16b6751.js"><link rel="prefetch" href="/assets/js/36.84da4777.js"><link rel="prefetch" href="/assets/js/37.f584e26a.js"><link rel="prefetch" href="/assets/js/38.22809fd4.js"><link rel="prefetch" href="/assets/js/39.87565ecd.js"><link rel="prefetch" href="/assets/js/4.03ca31d0.js"><link rel="prefetch" href="/assets/js/40.99aa2710.js"><link rel="prefetch" href="/assets/js/41.ffdc7e56.js"><link rel="prefetch" href="/assets/js/42.c8035223.js"><link rel="prefetch" href="/assets/js/43.e2214561.js"><link rel="prefetch" href="/assets/js/44.0451c7eb.js"><link rel="prefetch" href="/assets/js/45.c7c5d317.js"><link rel="prefetch" href="/assets/js/46.c515681e.js"><link rel="prefetch" href="/assets/js/47.a8782c24.js"><link rel="prefetch" href="/assets/js/48.8f8216de.js"><link rel="prefetch" href="/assets/js/49.c62cf464.js"><link rel="prefetch" href="/assets/js/50.d368641c.js"><link rel="prefetch" href="/assets/js/51.2d563851.js"><link rel="prefetch" href="/assets/js/52.cd107f70.js"><link rel="prefetch" href="/assets/js/53.947bfe0c.js"><link rel="prefetch" href="/assets/js/54.3fd47ce6.js"><link rel="prefetch" href="/assets/js/55.54035b51.js"><link rel="prefetch" href="/assets/js/56.4b338e06.js"><link rel="prefetch" href="/assets/js/57.3dc90d2d.js"><link rel="prefetch" href="/assets/js/58.d8c80a8c.js"><link rel="prefetch" href="/assets/js/59.3ba9b603.js"><link rel="prefetch" href="/assets/js/6.67d8c318.js"><link rel="prefetch" href="/assets/js/60.7de94339.js"><link rel="prefetch" href="/assets/js/61.17ac02b3.js"><link rel="prefetch" href="/assets/js/62.34d201e5.js"><link rel="prefetch" href="/assets/js/63.44d78f9a.js"><link rel="prefetch" href="/assets/js/64.b6341398.js"><link rel="prefetch" href="/assets/js/65.74297b02.js"><link rel="prefetch" href="/assets/js/66.e27db92d.js"><link rel="prefetch" href="/assets/js/67.08815a96.js"><link rel="prefetch" href="/assets/js/68.ab305a80.js"><link rel="prefetch" href="/assets/js/69.244199d4.js"><link rel="prefetch" href="/assets/js/7.6ef23db2.js"><link rel="prefetch" href="/assets/js/70.16c8374a.js"><link rel="prefetch" href="/assets/js/71.32994fc5.js"><link rel="prefetch" href="/assets/js/72.cd5e5614.js"><link rel="prefetch" href="/assets/js/73.95a35acc.js"><link rel="prefetch" href="/assets/js/74.45311324.js"><link rel="prefetch" href="/assets/js/75.5bcdecc4.js"><link rel="prefetch" href="/assets/js/76.524ebead.js"><link rel="prefetch" href="/assets/js/77.b68128ca.js"><link rel="prefetch" href="/assets/js/78.24beb1ca.js"><link rel="prefetch" href="/assets/js/79.086f08d5.js"><link rel="prefetch" href="/assets/js/8.46452597.js"><link rel="prefetch" href="/assets/js/80.05f17557.js"><link rel="prefetch" href="/assets/js/81.892e81b9.js"><link rel="prefetch" href="/assets/js/82.6eed85e0.js"><link rel="prefetch" href="/assets/js/83.55540564.js"><link rel="prefetch" href="/assets/js/84.df22c114.js"><link rel="prefetch" href="/assets/js/85.082bbedf.js"><link rel="prefetch" href="/assets/js/86.7d3cb835.js"><link rel="prefetch" href="/assets/js/87.53fbac2b.js"><link rel="prefetch" href="/assets/js/88.01455844.js"><link rel="prefetch" href="/assets/js/89.f86e57f5.js"><link rel="prefetch" href="/assets/js/9.ef8fa7e5.js"><link rel="prefetch" href="/assets/js/90.923a5b8a.js"><link rel="prefetch" href="/assets/js/91.7a019c2a.js"><link rel="prefetch" href="/assets/js/92.397eea0f.js"><link rel="prefetch" href="/assets/js/93.059d7112.js"><link rel="prefetch" href="/assets/js/94.84e5aa9d.js"><link rel="prefetch" href="/assets/js/95.0f3904d2.js"><link rel="prefetch" href="/assets/js/96.05b74007.js"><link rel="prefetch" href="/assets/js/97.fab30f76.js"><link rel="prefetch" href="/assets/js/98.fe86df06.js"><link rel="prefetch" href="/assets/js/99.68d7a172.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">行也安然，坐也安然</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据存储" class="dropdown-title"><span class="title">数据存储</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据存储" class="mobile-dropdown-title"><span class="title">数据存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db/mysql/0.html" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/db/redis/0.html" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/db/mongodb/0.html" class="nav-link">
  MongoDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/common/0.html" class="nav-link">
  vue 常见功能
</a></li><li class="dropdown-item"><!----> <a href="/vue/v3/0.html" class="nav-link">
  一个项目的搭建
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="webpack" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/record/0.html" class="nav-link">
  记录
</a></li><li class="dropdown-item"><!----> <a href="/webpack/practice/0.html" class="nav-link">
  实践
</a></li></ul></div></div><div class="nav-item"><a href="/read/jwt/0.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Reading
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          NPM包使用记录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/npm/log4js.html" class="nav-link">
  Log4js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/markmap.html" class="nav-link">
  Markmap.js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/react-pdf.html" class="nav-link">
  React-pdf
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据存储" class="dropdown-title"><span class="title">数据存储</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据存储" class="mobile-dropdown-title"><span class="title">数据存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db/mysql/0.html" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/db/redis/0.html" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/db/mongodb/0.html" class="nav-link">
  MongoDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/common/0.html" class="nav-link">
  vue 常见功能
</a></li><li class="dropdown-item"><!----> <a href="/vue/v3/0.html" class="nav-link">
  一个项目的搭建
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="webpack" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/record/0.html" class="nav-link">
  记录
</a></li><li class="dropdown-item"><!----> <a href="/webpack/practice/0.html" class="nav-link">
  实践
</a></li></ul></div></div><div class="nav-item"><a href="/read/jwt/0.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Reading
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          NPM包使用记录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/npm/log4js.html" class="nav-link">
  Log4js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/markmap.html" class="nav-link">
  Markmap.js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/react-pdf.html" class="nav-link">
  React-pdf
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/read/jwt/0" class="sidebar-heading clickable open active"><span>JWT</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/read/jwt/0.html" aria-current="page" class="active sidebar-link">JWT 疑惑记录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/read/jwt/0.html#确认-cookie-和-session-流程" class="sidebar-link">确认 cookie 和 session 流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/read/jwt/0.html#cookie-知识点" class="sidebar-link">cookie 知识点</a></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#服务端怎么设置-cookie-的" class="sidebar-link">服务端怎么设置 cookie 的</a></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#session-搭配-cookie" class="sidebar-link">session 搭配 cookie</a></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#图中的-session-库" class="sidebar-link">图中的 Session 库</a></li></ul></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#于是就有了-token" class="sidebar-link">于是就有了 token</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/read/jwt/0.html#token-登录流程图" class="sidebar-link">token 登录流程图</a></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#用-nodejs-举个例子" class="sidebar-link">用 nodejs 举个例子</a></li></ul></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#于是有了-jwt" class="sidebar-link">于是有了 JWT</a></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#认证流程" class="sidebar-link">认证流程</a></li><li class="sidebar-sub-header"><a href="/read/jwt/0.html#说点优点" class="sidebar-link">说点优点</a></li></ul></li><li><a href="/read/jwt/1.html" class="sidebar-link">在 Node 中使用 JWT</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/read/pm2/1" class="sidebar-heading clickable"><span>pm2</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/read/browser/0" class="sidebar-heading clickable"><span>浏览器API</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/read/chao/0" class="sidebar-heading clickable"><span>琐碎留痕</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/read/book/0" class="sidebar-heading clickable"><span>读书笔记</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/read/js/0" class="sidebar-heading clickable"><span>JS知识点</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jwt-疑惑记录"><a href="#jwt-疑惑记录" class="header-anchor">#</a> JWT 疑惑记录</h1> <p>JWT 即 JSON Web Token，是目前最流行的跨域认证解决方案。</p> <h2 id="确认-cookie-和-session-流程"><a href="#确认-cookie-和-session-流程" class="header-anchor">#</a> 确认 cookie 和 session 流程</h2> <p><a href="https://juejin.cn/post/6898630134530752520" target="_blank" rel="noopener noreferrer">更详细的看这个，以下细节也来自于这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>cookie 和 session 在最初的认证登录时是一对功能点。<strong>cookie 体现在前端，用它来保存认证过的标记（sessionId）；session 体现在后端，用来保存认证过的信息（用户名、密码...）。</strong></p> <h3 id="cookie-知识点"><a href="#cookie-知识点" class="header-anchor">#</a> cookie 知识点</h3> <ul><li><font size="4" color="red">空间限制(Domain/Path)：</font> cookie 设置带有空间范围限制，通过 Domain(域名) 或者 Path(路径) 两级处理</li> <li><font size="4" color="red">时间限制(Expires/Max-Age)：</font> cookie 设置时需要带上时间处理，通过 Expires(具体的时间)、Max-Age(一个毫秒数)中的一种。两种同时存在，Max-Age 优先级更高。如果这两个都没有，就是<strong>会话 cookie</strong>，浏览器关闭即消失。</li> <li><font size="4" color="red">secure：</font> 浏览器只有在加密协议 HTTPS 下，才能将这个 Cookie 发送到服务器。https 下自动开启。</li> <li><font size="4" color="red">httpOnly：</font> 让 cookie 无法通过 JavaScript 脚本拿到，主要是 Document.cookie 属性、XMLHttpRequest 对象和 Request API 都拿不到该属性。</li></ul> <h3 id="服务端怎么设置-cookie-的"><a href="#服务端怎么设置-cookie-的" class="header-anchor">#</a> 服务端怎么设置 cookie 的</h3> <p>响应头中设置 <font size="4" color="red">Set-Cookie</font></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 设置一个</span>
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> username<span class="token operator">=</span>name<span class="token punctuation">;</span> domain<span class="token operator">=</span>yuming<span class="token punctuation">.</span>com<span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span>blog<span class="token punctuation">;</span> Expires<span class="token operator">=</span>Wed<span class="token punctuation">,</span> <span class="token number">21</span> Oct <span class="token number">2025</span> <span class="token number">07</span><span class="token operator">:</span><span class="token number">28</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">GMT</span><span class="token punctuation">;</span> Secure<span class="token punctuation">;</span> HttpOnly


<span class="token comment">// 当然一次 HTTP 请求中允许重复设置 cookie</span>
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> username<span class="token operator">=</span>name<span class="token punctuation">;</span> domain<span class="token operator">=</span>yuming<span class="token punctuation">.</span>com
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> height<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">;</span> domain<span class="token operator">=</span>me<span class="token punctuation">.</span>yuming<span class="token punctuation">.</span>com
Set<span class="token operator">-</span>Cookie<span class="token operator">:</span> weight<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">;</span> domain<span class="token operator">=</span>me<span class="token punctuation">.</span>yuming<span class="token punctuation">.</span>com

</code></pre></div><h3 id="session-搭配-cookie"><a href="#session-搭配-cookie" class="header-anchor">#</a> session 搭配 cookie</h3> <p>那么 session 是如何搭上了 cookie 这艘破船的呢？先来张图看看：</p> <p><img src="/assets/img/0.c9de8ea4.jpg" alt="An image"></p> <ul><li>浏览器登录发送账号密码，服务端查用户数据库，校验用户</li> <li>校验成功后，服务端把用户登录状态存为 Session(它可能包含用户信息、session 状态等)，同时生成一个 sessionId</li> <li>登录接口返回时通过 <strong>Set-Cookie</strong> 把 sessionId 保存到 cookie 上</li> <li>此后浏览器再请求业务接口，sessionId 随 cookie 带上</li> <li>服务端查 sessionId 校验 session</li> <li>成功后正常做业务处理，返回结果</li></ul> <h3 id="图中的-session-库"><a href="#图中的-session-库" class="header-anchor">#</a> 图中的 Session 库</h3> <p>之前最大的困惑在于，session 为啥老被说成<strong>占用内存</strong>，<strong>占用资源</strong> 或者 <strong>慢</strong>，了解一下 session 存储方式就好了。</p> <ul><li><font size="4" color="red">Redis（推荐）：</font>内存型数据库，以 key-value 的形式存，正合 sessionId-sessionData 的场景；且访问快。</li> <li><font size="4" color="red">内存：</font>直接放到变量里。一旦服务重启就没了</li> <li><font size="4" color="red">数据库：</font>普通数据库。性能不高。</li></ul> <p>看到了吧，保存到变量里占当前服务器内存且容易丢。保存到数据库，就是慢，具体为啥慢不懂。最后就是 Redis，快且不占内存。</p> <p>但是，后来有了分布式的概念，和集群啥区别我也不懂 🙈🙈🙈</p> <p>反正个人理解是有了集群就有了负载均衡这个高大上的词，所有的服务先走人家 <code>nginx</code>, nginx 知道当时哪个机器不忙就给你传送过去。但是哈，但是，你万一是在另一个机器上登录的，不忙的机器不知道，那直接变量存储放到内存里那就更不靠谱了。所以，数据库保存或者 redis 保存就更重要了。</p> <p>如果量比较大呢？所以，你得单独搞个服务来处理数据库或者 redis 来存储这些信息，于是就有人说，不行，这太<strong>占用资源</strong>，太浪费钱了，。</p> <p>你看，还是不太行。</p> <p>有咩有一种方法，我服务端不保存这些 sessionData 信息，靠逻辑发电。</p> <p>你来登录，我处理你的登录信息，搞个 <strong>标识</strong> 出来，再发给你，你下次来带着它，我在逻辑里解析这玩意，一解析发现这就是我的东西，那我就认为 We are 伐木累～</p> <h2 id="于是就有了-token"><a href="#于是就有了-token" class="header-anchor">#</a> 于是就有了 token</h2> <h3 id="token-登录流程图"><a href="#token-登录流程图" class="header-anchor">#</a> token 登录流程图</h3> <p>先看图，先看图：</p> <p><img src="/assets/img/1.a416162c.jpg" alt="An Image"></p> <ul><li>用户登录，服务端校验账号密码，获得用户信息</li> <li>把用户信息、密钥 配置编码成 token，还通过 Set-Cookie 保存到浏览器</li> <li>此后用户请求业务接口，通过 cookie 携带 token</li> <li>接口校验 token 有效性，进行正常业务接口处理</li></ul> <h3 id="用-nodejs-举个例子"><a href="#用-nodejs-举个例子" class="header-anchor">#</a> 用 nodejs 举个例子</h3> <p>nodejs 通过 <strong>cookie-session</strong> 库就可以处理 token 的形式。</p> <p>看下面的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">cookieSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 存储到 cookie 的key值，可以不设置，有默认值</span>
    signed<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否给 cookie 进行签名处理，为false才可以不提供密钥</span>
    maxAge<span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token punctuation">{</span> userid<span class="token operator">:</span> <span class="token string">&quot;12345678&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3002</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;server is run at 3002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当前的情况下，通过设置 req.session 就将 <code>{&quot;userid&quot;:&quot;12345678&quot;}</code> 保存到了前端，长这个样子：</p> <p><img src="/assets/img/2.7ef9d43d.png" alt="An Image"></p> <p>这里的 <code>eyJ1c2VyaWQiOiIxMjM0NTY3OCJ9</code>，就是 <code>{&quot;userid&quot;:&quot;12345678}</code> 的 base64 而已。注意，真是转化是是标准 json 形式 <code>{&quot;key&quot;:&quot;value&quot;}</code> 中间没有空格。</p> <p>如果有个大鸟，他手动转了一个 <code>{&quot;userid&quot;:&quot;12345678}</code> 的 base64，然后替换了自己的 cookie，就可以直接访问 userid 是 12345678 的信息了，这太可怕了。</p> <p>所以，得防止篡改。<strong>给当前的 token 加签名处理。</strong></p> <p><code>cookie-session</code> 库提供了两个配置：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 用于签署和验证 cookie 值的密钥列表，和 secret 相当，可以简单的理解为多个配置。</span>
<span class="token comment"># keys: ['key1', 'key2', 'key3']</span>

<span class="token comment"># 签名密钥</span>
secret: <span class="token string">'harryport'</span>,

<span class="token comment"># 是否给cookie进行签名处理</span>
signed: true,
</code></pre></div><p>所以代码更改成了这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieSession <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-session&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;cookie-parser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">cookieSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 存储到 cookie 的key值，可以不设置，有默认值</span>
    signed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否给 cookie 进行签名处理，设置为 true 必须有 secret 或 keys配置</span>
    secret<span class="token operator">:</span> <span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 密钥</span>
    maxAge<span class="token operator">:</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token punctuation">{</span> userid<span class="token operator">:</span> <span class="token string">&quot;12345678&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3002</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;server is run at 3002&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>设置完后，cookie 的存储中会多出一个带 .sig 的 cookie，它就是 <code>{&quot;userid&quot;:&quot;12345678}</code> 和 密钥 <code>key</code> 通过加密算法计算出来的。前端保存如下：</p> <p><img src="/assets/img/3.81e15891.png" alt="An Image"></p> <p>它的签名过程如下：</p> <p><img src="data:image/jpeg;base64,UklGRsQmAABXRUJQVlA4ILgmAAAQDAGdASq+BYoBPpFGnkylo6MiINSZWLASCWlu/pNnbQCGlO+K8P1kyjtPFX9c/GHwL/uf93/aPz/8Q/kn2c/u/7M/Ev/WeFP0X+q/5voX/Hfsx+E/uv7of3v2n/xP9U/If0b+Bv9v6gv5J/L/75/cf23/vHC8av/pv+56gXrp9Q/2n+B/x/7F+kL/sehP2C/5XuAfzz+of7j/Ae3f+y8G/8X/uP1a+AD+df3P/2f5b3YP5//0f6P8tvbF+i/5P/yf6r4Dv55/bv+T/iPa5///uQ/bn//+59+4v//D/OtFt9qyKIcWd8ope4s75RS9xZ3yil7izvlFL3FnfKKXuLO+UUvcWd8ope4s75RS9xZ3yil7izvlFL3FnfKKXuLO+UUqre1dv2D9k19evXr169evXr169evXiaeTLfw4s75RS9xZ3yil7izvlFL3FnfKKXuLO+UUvcWd8ope1oW4s1R+3HoqVEckjcGb2cgfnX5gn0i58wrT8IbZ90JdHmV2vOCtDAlyHFfC/lFL3FnfKKXuLO+UG4wW6D8BHZQkjqSEnh2JBNtEOLO+UUvcWd8ope4s75RS9rQtxZrRHVy+/0jdfr8WUEJZW4gRjOyFdaFh6D0h0mYwNCV0E8olbdBmS4av3aIcPGsWd8ope4s75RS9xXQSqvDr//3yTLamdZw6/8dgpDizvlFL3FnfKKXuLO+UUvcPGsWd8ope4s75HtpRS9xZ3yil7izvkYA/Za7tiBbUQI4zHm3dmyjlFL3FnfKKXuLO+UUvcWd7ppbfasiiHFnfI9tKKXuLO+UUvcWd8jShbqS632q9/rGdxRDizvlB19qHh7FoUKFChQoUKFCZCXIL/rIogfRgW0JoZ+PHjx48ePHjx1fvr1zA+jDizvlFL3FnfKKXjJ9BHPKzyfrk0VgeOOBQy7VIvHbSptCMX5xECVuju9t8GQIhxyY/+J6MuRMJJyAAohxZtAvNweKQfbQbVRYY8Z20/PY+fY+fasiiHFnfKKXuLO27zzbYKERuRgvrvpQDuA3zxHOnFOIKMFaAO5VoAuwIZsbMpon8rVPx/CbIYihK3R7BiXBmqoq/T1Hqp8TgW5acTQhIx1NuLzo+Dd1X2VaxCj4VvFfUH5dwpTChovOCu8VaUrvvIeyvdmLI02ELJOwLBrlmAfd5YDPg+lx9hzdngNWlXy2PQRqXAKaa9bJNTxF54KoHlehAngJTbdYmu5dYNrCNRgUQkoJetVB7NB3sBR6vdcvuguw4gxrHlEclS4PxsMpB6/+xUFEuIGbTqdAU81nyzexg5lheGSXvTHqVw0FQK9I1otvtWRRDizvlFKs24pI3ag7a0nUyObzdOMPDuDVs7DLw4s75QkZOc3cxej1FfyfoyXa0LcWd8jOaeNaFtbBbDnrToz9e0lzXxC2tC3FnfKKXuLO+UUvami65uX4cNY77rjnkGi2+1ZEhVZZZ3vkHEuD+PHO2l8jRo0aGr3wRkUQ4r0jVNyRbOT169evXr169eu8bUO16T+hS9xZ3yil7izvlE7KRN0awV8tcV8zD0k91FrNAUUvcWd8ope4cTTlFL3FnfKEmaKXuLO+UUvcPGsWd8ope4s75RS9xXTG4kmW5wnLhUoxivwJwULbILWG5Nb7VkUQ4s75F46Fd0eQv0Cs9cfRugl7izvlE96FL3FnfKKXuK9I1otvtWRRDizvlFL3Dlvp2HMOY9GfdpkUQ4s75RS9xXBRmjlKhz9IFRDWy6/6hUnHZot1Ywa1m20q2e/dQiWohxZ3yPbSil7izvlFL2tC3FnfKKXuLO+UUvcWd8ope4s75RS9xZ3yidocfVhRS9xZ2+dFt9qyKIcWd7ppbfasiiHFnfKKXuLO+UUvcWd8ope4s75ROxNPeowUvcWd8opWWZe4s75RS9xZtAx3yil7izvlFL3FnfKKXuLO+UUvcWdwjxkkWLFg4DUBRXPhRc4cV69euxQFnfKJ70KCn67hWJDG8CcgYzQsiiHFnfKKXuLO+UUvcWd8ope4s75QdfZfbuGBAgP6taBAgQHnpFFyL5RS8fRgQ1810eUCtJZQt+XgMGGMDLxvw5EaamO6hSFF4FFL3FnfKKXuLO+UUvcWd8ope4rz7QrwtmTWuI5EwL0XCQZ5+/6eT8moqReOLLaT6FL3Fm0C9BAcU9xn5BVBeQtXEVA4LZq9QeGIpMYTPzM1RRouu9Ce9Cl7izvlFL3FnfKKXuLO+UUvcWd8opWRm0imNt8GO30OeqsjaOZFp/qRz0twWNORiueXzC9KUJFZVxIL1elSg5v0LF4DraTFA0iPUmWAgZAOaAf+F22JiGihJeRMWwBcbm4y/vhidxREjjgwgxzox6uSB0JV62+fpHDY3CBdKdkwI1CVbwY7bHawfHugfJFgBkTABJ9Cl7izvlFL3FnfKKXuLO+UUvcWd8opWRm0ope4s2gY75RStm4eNYs75GfU7xI6BQV9NLb7VkUQ4s75RS9xZ3yil7izvlFL3FchXKL9VAgQIECBAgQIDxGokFeBRSssypVwDmpCIe6FUyggwr169P/TvRbEora0CzvlFL3FnfKKXuLO+UUvcWd8ope4s75RS9xZ3yil7izt86Lb7VkUQ4s73TS1LQKQFbGaG210gzJww5h+aUk6V3AucYBdqV2Iy510YEs75RS9xZ3yil7izvlFL3FnfKKXuLO+UUvcNcGujOJI3J06dOnTp06dOnTp06dOnRe/m2NBfG5LFd0egSidX3pmZz0mNzFiwO1tldANRc/ntsI9eJh3cgZcHOJ/vAApgguHgxzkF+ycfrbJs60W32rIohxZ3yil7izvlFL3FnfKKXuLO+UUvcWd8ope4s75RS9xZ3yilQAD+/2DQAAAAHgAOiX5P1F/Ajq7GrhLMcja+FwZ4LzGRB/epvJztnNlAAAH1ZGlUySRics6SCeQ0/SY0wXrrH3/x1lnUaT0l7+hKpxBQbuVcP5M4ALEkdz8kItENGXo4xm7nD4YTHyFkF+UZbCzfu3hGhMQyPxcJc0w/cxWj0b7VYxnFiSxy1bjNHKIK8ehDRl6OMZY00Wz2frDZSBfEw7X8wHn8d2z4VlwA0UoIb/w29P9/RnQTQJSaXDgy4Krg5Ow92AEW0C2rpr41zC0UWhMTcc18Fp0wUMFxFDvSdJTm6bOHYloz6zA5ImUkyPh55bq6w88XlP51NryHNBUm2JAULkJLpfA1m4XoP5K85R52GNZCoqSV6cwxVFzEUFUQYUHAmB9WjO2/EI5sh4I5tvT6YkFt9pCp9GxBOjB2lH6UPt4dcz/j14RkxzGx1ZIVF3tgD8hrVBUycoZxQloC6eCQI9eqrn/LO2NOySwSn/DauynN7sHIQ+rP/odJ7wz7SF7AuFxWr2OMnWPyfNCACRXbj97JvuNUCEClCEsc5fOxAbGVvXHqqfXFZTgNi/z/GhUF3sB04UDTyweAiZzk5N02rH8PB3oF+NuX6XnMsfAnhlnjluOT6dJxkiyaVTx7K8CEWPwMGQfbP+RR+/eGQLpbkf9oF+5WUwQB32g1iX4xonN7jGQXA5clELneT4wtWWv7lGPq+79OTGxUwT3v6+GRTwiQ+OyE6aKVxvNymFKDhQ25fpL8oMFAI5kW/Q0LDFllyWQxkk+igSr/9ESwLbS4VOGTezwKusXqEwbNgKAw4/MwnKI8QpnQ0CaqLelVZi+vlXMJa546gfH7r6nO+y+oNXE6nZJPnNmNmNGaE1XvbMkjmKSwk8xwb5j0C0tGSVgX5uBpvuA3CsZHgKf2jPpUytCaceW79mtmI6Hbl3BbVwejt4Y1u9ZR2Gkp1xYbJT7n5FH7+xz5UlPZJCJnqohA+TnMmosRB1R7+ERqYBs1uGWyvcpJpM4Hnwrn5mC/yqzGNOMeRM3wmNWwICybIjHfKPRSGc43/XHl6imVruTcO5/RLlJHY6Qpea7Jkft7QlOdAsROaTd1mhFWXozkt1iARd3zE5OuhuLkNfouOEnUNUBg4WiRaGu6eYMA0xWwWAZI3kr+n/UhFH4pl4HZhk1EWzuhPgQCDSNV1CfyIVcX9o/NfQ9uxq6b6UC9weOy8ROAq21JuOP/t9CVBR/8RtzxBLxObL3M58Rr6dv4hSjB+zw5MSafwIABismMKMKKcL+D35GeNKCS7kOeOWx8fWt2lqjiSCFJnID7Hj7fzPmrgyqOsv9FjYYwpyv3mRgO455jYae2CJc3AYo8TJzH4gQFh3LN1iVXTRo/uKb5OOWZyAJ+mYv2IiNQ9MOUMUmdhQ6a/nb9hB3FXI0yOYporl8dBmApE5NMdq935tl4Dw+sHG8z7aPHZ+j8zx8IaPN3GcwvPf6is8ERxJuO9is2m9hMvpV3fYFYFoTxOazwSOmGWCD7ZnZb2ThrOd0LPBcCzfWsw49WLVry2hxWeq1+HcDuOUSI4r2A3dKJX2FV3w0/tpLX86GpfDxSaBCTg3M5CBaI1KsTuBP8T51clhtQSAHj/t2o995p81ABJxOnIdfGgXz9dHs8gX433flZdqAF5Hc+7eblIJnbSr3leGnUAN0U9D4MAroXzKgUuo0CPUgfpc+cgDWoivPkeSIBeKZOd4hffvEdp2Bgm9u3UD/MdK7f9qstHZShDFPR69Hj+gkzTDYM+aoWlaELj//N78DwWMeThe+bSPGJZVmL2Z1jad4F4Tstnk96xsO17r47hIJ4kakjKzOyApxxrBVx9C5VQL36dXZ4wwT33U0hjYQDcU0ga0pKEfxC/LIDuPK5D3wxY3y5VX/BJIVLeelXtSTQYjP7uix7KZ9DpLclTHB7/uSR/Ab6U+IxHWi9XMz2nePHelYf9ZrST5uKh40wRDQnRAqbaTUiMMUYGkj0nyrjvNq89uE5NWR9lFqKaA8HtQ8ey4lAOS2K310/er86UHApypkndI0suO+GI+4n4vuhJXsr36hj+Y3gj7zUBt1MLQpkHH04X5CTVMSeRrGG4U8Q5zYOidsIPwZNU+1N0hd5Cp3L8KXWO7zxJhZUrE08hYqglAJfTJbOloAtDiq3KImMzNOO6RVcQb6lE0pt7QFyCrK0i2Awhen6y35+YSXAShLAljWQUqwUnXdLaMUMhVRGR9BgqUOnTjQWSpkd3RdJRNGeYEJ8mtFQP+OmTXO+pwXP1+P+7eFpWsno94UOupfweno3X68fimorcl/F9wSfwvH/HJQ6au8M/YWNK+g0Ryncayd8PGvhXPWl6TBBni7hSY/buwC6iPVqIVMfpon8Gqz4jlBPULge+EXmQByUWGwmVDtDI7flqq769svh7PEB9041EZiO4j8FctPLilu35be8lsc+iX603rvinRIKTWb43X4UgE0DZQoiEBnVbahs5S6MYi6v084JV5CATEmxnguB2IjZjzWhSb7uECLdRAbPjNQatBlL4faxABM962yl8WE7SVPd77RXcVCfO/NecelRyeb8ZTAMmrMhr6a/kHczljxao1MtNHZyj0HpRtWk+inP19O8pC2cesnO7SNNtSgeEVRbQp8adWBQWHf3K48iVViy24TQN4Xyehwty87gJa9Wcr70krXJfpb8WqT3I6G0uTzvs/2qLH8/mW9EudYSLLkoursrVRoWMdVng7dX3s4KbBJjOgRZmR91pUOyr2w/ggSsOqQDw7J8SggW6z4Xof4IOljpW27lZ30HugwhZk1VBwkafMAAqasDm73y6xLZoHDJOtR++sRYV81qCH9w+FbsZKrMjSsrOPpFaSC3P4u1TWr3T7GiwSA8Smqqxk/pP80cHHHc0fBpEgQ8eY7kSeSI1lO3e/RJvdkJb99S8OWdCPOShV3qPmGt3gf+WNAHH/fPpfr8sgJXHOgFU0uxUMagWOyNN42rp/BlD5r+jNYsEMyXgtPjwqjy79sedjf/EwdNjz0UlVP1Y1t0hAAkC+Idk0y7HsPoxbFu8fIHI9+7f6H95u2INyH0YjONRfQDwMHzGbY2KIA7wRiGRofsLnTvQrcuAaV3+m3hv3+8BljmAMY1Te9U5JREzWN++by5fXwdHUl9mnNaO1oJ1UB3Lp/0fREX7ocYKZrZE+WObHMqsuj6qyLUwOZPgxs5CyfIU+ut0hEVxZsT2utp/0d0jkOo1dIkk8dhwwpBi84Q2OlDp3+M2dOwikuO6yOb6VU8hWlB/uJxW2tVlhdV6as3Zfa+8b3F1845J1SA08PHaZ/U6qNWlMkxbY1ebVym9iFUtIpbDs4dJIqHkcDyiC+LWr/J5PJGJ2QglQWRUBIIFgZ6PfRuFqUUEfQDdWtT4Ojmo40AnZ3Bq43HNHgUD0l8GopvCmt9Ly4fggnONlgcE4FaaSaTpSkVUbG+xHbUmywirODSvPBMgWf4h/yjuZDyr7wQI/tkADMTXarzQhtfzUv/6TpRNIqNHthLZ3hmljTXed9y7rbiTDVNf270Ct/DbPImem5waD3yL9jFFJfrytxOLTecK4PCEPvyAklayK68okE9LgfMigO/HkTfZwCE4FG+sCNY15s8T8zXgeooh4EkkTBUFf2b/qa65LcRyozhCjurQkxFio1bB8StVsxjSI8wARZFizIKxm39UEU2RfMxntNfo7pXj6aaxnNtKdrF1awTehJRjwsWDJErpj/8iFdOX7kDbkpUvSQknvC3mX+JzA2sZNktMNDFPPLLHij7EBmJfLod9kMJ9NZ6sedvJvGM6ohd76V4h43C/D7JpjDU9Pi+jJRQKudl03bGjGbgCaYwq6j7dRaDFwTSDyurgsxnPxzqy3gwUfNd1qkv0KjHbSzPRVf1r1NEW8Hn6OhyGO7GsY3yByzvBVcWDO5XmPdsn0OiNVGcWP5AsAR1eTD6SV3ytSLMJHUHeaFQVomnErtLTvAE+YAsSiTV1sRCYHvBO/VDDXFHNExNY/3Nazyuat/8NYLH8hkTCLqthh42kfiV8kLjWRSQy6nsK8bH6vkKor6/okLJw+r7BZycZTPXsuXQ21yVuE5naBr0IyX+uGYI1dM55svfZ42/MXD4mbMeMoc/qH76j2bYmB4CNL06/1wJ5+fnyCIwIdxgbWAviWq4k+fbDenEJDRQMYZtqrwMmy62+sXXpoJlNOOMFmx5TKX3JDKPuDBxvXD9ErZYOzCfOPUP83/I9Xx4+YHWWBhaV/TWbMWiVuXPMNFjLYYaP9vqlBqOzRTHJAc6V+WFsdOyccrIyie++UVn9VEkm5+W0nZZmwqPmTnHM9YHodFAjU7zd1lNYpaQzyDX1QmW872bB0Vv9syslAOJruwsxf/cBOOLJve7htE+YIA+ql00+oQn8xbWQR+t/IxD8FqFgFtMKEjoXjOvYKYBekIQlYfKbVZ4sFp5b6shdeq36qp+AZn/FWkWxpc+jM0PnnMgQaA/saVBLTE/XQQPy2W8USTMFjHWYREyl9N+nHrbVoaIS4Uu8jdkVVgmNzS72yturzI+JwCRUGu8H6TxJLQ8CKnRZGPAnTsHRBaMa8h+K9HgPZKhH2IV1BfwjAdG091rczRT/tzV6aQgVQKEISk2V6oaPolB94ZhECyYp+MXEdfaRl8oSHxtiUq5uOu2bpaU2CNgXx3DM7cTwICb90jXgoUmM/E8py8YR1rh9IjDtzwMl8y3RJCPUuEytjNRgu2ucXZXzysfkDVXfsvH0KhidUdwBuOXbMC9/xOvyj9SBRfWFE/OXOzaz/NB4VKiAYmwM5/U/j+KlWnI4ta/EBECDZ7M5EobrJxaDGFVmPepwdlkBJxsrjRyvuey2yjg9Zl/B8oKA7UC+m1CQGySy5d8tQCGdZaCSCaOSMCjImTmGvId8ZhCbp9VwotZKmmjwf4PoKVqTuiPdOvgNL5TLgfeHEczmWfxJbZdmOk7+nNOsc2gOtKhpkzw7TI5K5B+aZWQD+fNwPv6Q4MVIZn6grk6cDXoRYieSG4+W3MsGXUxX3R++ER/wvKTBrU4d32GfSKsVQ8q35Z+as0/CjQRvvOezOOOOpfXE7/s6NMRxEZd/oB6O40Eutgzckr8mHJHcBHvTYxECrMGcQQI7fgCc6+xBpdDWUJxbGdgTz+5TlOHpZ23+e29WRi/zNjrBXCaAVCvOKBi36OIKtRzQzOwJktid466/yCzy/TQxRdC0qAg9Jov7dGZyeYKAoSOl5W1JibVabsfhH2OIrx8gIF5ofUpNOnMtbyfJyS7uP7WhIqev0OmKWPAji39bphSdsYMwB61bw4bo3yH7+lB+T469mLRRwaZOV4z1EB9Tq8XD5ziaBSBmWTRp5d5ZEGaySXDlz3wQo3PBHKguKSC1sVurt5hNbu5fUkB/ScqJJKyCCRPoCBYpPDaFePZ2cztFwAnahpJlHYlhCuuogIoDJW4gZlSKYnUuieRAcRhR+VXSHqZVrUQyfJobplxHKtXkaiDFXeNQgwgIjgOu4La0JzL68Ig52YA+oLAjuw9fmb6Y9I2JtDViw5QKDty/G0NceBes7uUNXTBoiG0DBYtOcqyyT9flB7nQ/mvxSC2ubdWaHBbLs+xrJ63P9ozA3egCLdL0BzmYrAAi1f4aKaSmOhiOKGd90E1mAOMwceb2W3qeQrNZs/7Hj1gN43ZhTXz25GIUlzSFSDsAV1JBd5U/Q240Dl38NxIouEK1XX3hhLffLSzlesRmTpn8W2ZfkdmygN+/wB3pbfgS4JvMZpVBiu5ule5ktdzb5gkREdbVeB/hhMX+FA9Ef87fjlev5Nk3flqSMG9SMVswGn21RpttR/oVuVUFiVdvjStz9YrIphe0VEBnXHe1OwGFA/y+qYshKkIShUNnbjMptwJA/BzDYL6XixKSL5r8Hgt2f+oPIqLM8xurPDbK1KVoPJD/kbeTb1TvVT5GEQRuI8Zp3C8+BSE5baFOYJk5rm+7GJ37ZkVrlGx/C3SeYaHdKPYXFUTfi1ns3hyxser2weLM47p1NZEVEg/YJjq+aOEjTWRx0F5Ptxs1zgQyBtn6hP3Qu/yozE1Dl5YE2bmaRy7N42wpjqOo3eqWOY/LfKORJc87hpeD99s7iFGrttIQpaXDh0oV6TNkcMVT7SesPyCHk1X5QHOgiXec+VsGx2B3t0bOJvJk0tt+KLkyLBjvnZmR2nxs098xtgy8Ci6L+AMvIzjx7dYIrYcV44iO6yKN4WNl00gFlZcszahJzeIG+m5EttJXDnBZihyi2ZtmtcVt45iGLBr2sdOJ/qNvviBLc1lmhAxj/kDfhISoBKKN5RSHUxo+VkmsANvFxLUS8BJNObObklK8kAeJfnPF0gc/oxLZqRGq+vEuhAHVv4/t7zAqi4371MnU2988V76osrhhdjL1pxYDr4zOWWPjPNy0Opb+8ZIq4M79LTJ6qDAB+Hp7tNNwLn+TNkPu85HqGJMnIB5a4w95bWu1eAkPRYgQxcT0LgfGB4B3I+ZA0cW0B8MAo09Z1PDpRsRCOPRZHP6VWEil6SfHfkGVWaWWWEBPqkRPjXIq+GAl5328RMRs9Ygnu0e4YX4hlWJuUtFEKFWsyUJMGLaU15oGN555vUHMEzRP2TJyCSsgCwgU0xdjgu7YOt91gzGDkYev1qQwGnT81o4ZxSmccTIlD1ABJ00GQYmEUFKGeBgF/edULmzSMnB2MIsicU0VJnNvy1ShT6Ryz3TC2E3Y2L1chX/Or5fKgcT3aNv2GQ3D4oXI66XT8Ht7sWdnEV4JobcvzRACjpoHqxzwv0uwWWxPo5jP/bFW+lB7DOVvZtPd/3H4wiP7L2+MMnyzIuFiuqVXf6gFmorIH4F4g499+Al2TF5zIXae47yQDk4QI0YBab949EZpoQdrCybzamsVFlnOX9U2Gu9egfHRh5fz3qZF09j4JPF4LSF7n0bBDsJaOLTcSG7VCI8wtsw8ADEPFGYT+OAp6aT+DoS5vdCKdeQvfmmrPQ+NcdGaF6Zbwxw/HRcrgltwqvnySQD6akIWDSIhUsidOH34L9BT7jvf9CwzXfKMvSHKsuQkG559A2qAwfqOyAys6vIFCfdX0DbFgoFiMr18hBgaU/zqTMveB/Jucekm4pV3uBQ9h9PhpBAHO6benRHF07Xya87D5PtP0GSM0krF2q9hqVmWcyVmnNJYGwCk3mH1eU9ZDzAIky9iCLkDddBaJlByjxY0iq9ziCPFBI4MFyuQUEvpbbuiBg8OpQe86T0v0qbXSQb6KUmykJf0sdddsHqL9cb6LFsWGa3EMPP41LcyoLV9zd8dchDidvadpzD6GNjOHEjIX7cnxm2pRosgapbwgD/lEzOxNVyivWtkI2urwVPCKVCj8DPdTDvP0/Gu1gw/xez8ltoqF65wVVfjoaXh8cL/njIzMZo7F2IXgAE7l5Pg6uCiSt13fYEcrSZC5lkDtowIU6N75KXtS6/RNS/zwedIfRUt71f6sMHls/iigS3ltKH1vur3A3qFfzyKWrslXhBqHu4p4Ep8NVu7EegLfqZOQLB22S8z5G7Y3rloNFs+VXnDHLrA8RaRMvVtz4w1TI32Vrh/NX5QXvNH+RZkVFUg//9OH4As+FE1aGdDTvIY3zMWq8Aqd4Xc6EWNwQgJR6UyF23PBbHQmUIMTsAOX5xTyz3PXqsTOv8jPLxEE/x6dR+8XUNJr9FlceO3F2NkDHV8cXiVtYi/PvQDKtO7nI0L0PH58LrO4qnaFTMBxaPPcz1lgp8uEt4wCQ057n8xQSFvDZzjX7RlvMgMyIB5Ps6oFU1DOtpA6nGsDiDzrqvmL8sQEjD2wwQwuOJgl+lQ84fbHXcQ5O0iOwfUv8AoVG/5qdn1w02vNIoXz0Zc9RQ5rbiWZjn7MjdYt15Gb2jj4dALwzaZcXlIV5FciuDSuJNUKgG48/2n/he/H2+iRGJymbUNlcKNI/M6SCoF5VkBoWfYXkJbaOJJJ8kiv9hrM+QyJhF1WwxrulcXgFytxrQQnFU6h456TKlLjJGwijuNEb78SvI9hmjlrhb6upVrJgZPcGUUdix01V8Sl1xIqdg7XK7ZQlYquumBcuzivYtk01Ux2BlY7hgk/D+4Dvr44X5NvY1kt19V4REOT4zea2CP+qSSiQrSAot6b8GBlaDlvkT96qzNIpWFNFBE7NfccOgdhvM16Mw2dSVJGNi9EE4dyUgoUlYi9B9k7whz5dXpgYkrVP+tbPhepIXS6icxnZkZBTGYMzzqv55thBngCpv7nQVSoe8kf2I/wcfgn84QMNmqEQSAU2bP06pMy6++dMbrc212K1es+UreJWMbU/V1tRW6QqEqFXDWhlnCVJpL1dieVXrr92erRu67O7OEUJlnS3utV72klqRpSiv/vkMoYDYoi46cD/DSWCLucbkkrozUzGvqMR53TmNYFcH9Pn1ytMS1waJFwQVWI3kvr2Jxw464RkTjGwhDZPPdZ4N8IUF4zEpjUu0XmcKuqwfByJhy6SUwga6ugbnhi7E0xyYmIIHlWs2ETlKMuOWxoIPEeVrTE+rSLKh9BGfKel/MF+yQn1w0QbCPVXqs+OLja1c4/h2+yPPzhXVsl9rAoODTbtvB1lZlBVRWupuUBINQomFRV8nmiqf9+gjE61bEDXyXuwkWEyxbPU5Ovo5ND3DlUfGdqHx1n0ExsCQFyNzMsTnbPXmteyY/rAdZlNqPtHaI3xoI1xwUY2C/rFx1X5o91EfTIagn2OBQb1V2NgzRUnVXMHWxfJUAstKZ6pTTgf0RhbLllAXjQgpnoWSaxhqDL1/4LV5GoGxsZYctP56HwvqJ/+vW25F6jEvYI9oiUXDdJkF/schW9Rhqq9FAvCB6KlyPxA5y23n+PlCQHNsD9t4jPlO0dgbZWFG4KP1jamMsaXfPBty0gXCmD+A251jsGC3T7AMFeEWCmQmxBV09kPiqFd7A/v9CN57rQcHRrDIk8gaDzr2u26lTqYwUpdkUIV16qJVFeJqGCiQDADkQq4Q9S52Fm3dymK9q0vKtgDKaRdDN3b3wid6L9MS0uPVMnIKApgT3o04KWuomepMefPGnMjIwrkZNUUTe7kLzZsRlEAQBVGeFT469mLRNyGAASqnGtMoboInFcFc7Hn7TgLahrvTZgLG4Pwm5vZax1UPGc8raowLzISHepE6Pi0vcoLu0Ypk2afbhydMydf3+30GbKAuFhjhm4Z0G+t40t6+mVdk+3is257ww2hOVimWd9BN5iH+ukJRPpLFzmNuZybHaCLC77QnZakLzdHT9IikjWGc/jqzlKzERee1Rafr5GFLfEmTHhyA+4OImJOQ0+lJmu5AiBMWajqbIJGJGAuvuohCvM6xPZAmBYiDPgwv8zesZCOMv+oQPJ4mIScDPZwHAkSXm7WFRPs4vbVmbb/0+DpVUQkl3xU9bRrUj2zJItG1FY0wUJ7aDSZTo3uyzcK2t3VA27CgwPeuuc7BqIW8N8TQGevCXKXEEydHYlCm9hNmP+5PKNkk1xzmPjezKeNnCMo0TH2oqdBQsMwNnrsHzwl9Ptx0ANXpCGB3nfC/YDeGUkYXQ324o9wD4RNsb8MIDS3CmMGn0di+IRWRoY28h61YsMOJHXMM9gAMKrxtvohpl4wfgBcLpKnhU3NXJLkm9WY9oY+B4gBugHbqUb6901tfDoHjeKPngK5g4t9Zg3xAoOvAI16xsc2ZeqY+6gDUqZXC1txARYoybF+mUJjXwNcl5aLOUJKQdzYxX9j0VtT8ibO9RjUAyV54H5Q8qTjQSflck2Y/oVe2IVj8E40PhrBGMkPrxO2nMwg+35KzVTGdGYOSLjSJL6RRCjwSNNvOBre6ZRjzUPv2ypZA7vV/swcUcou5o33fTmjUMmnEsTLrDpYyEoDvFlZTmmPFN1pglhTpOEKbR05IJyZJbM+nfEpvjj7yrKJ7E49G7mGX0RcD/b/Su9aEh03dP8w0JJbufYX3Ep/5JjY4mPX3Mu9D2FpODGRmD7VkpEkyLsSIQ529Wc2keYiN0C8jy/pvHuYhV6cou+fQaVJ7uPhHJxe8C0baGB4g43lAJOS9V0AQ0opYEgxDnrZsdBpeJCTn0fpZdXEGFuOYVFY79zcA4FHx3CGurFKYmCMrfqhKg0VMKiuxQE4f9Vl4+Aydiy1oUy7PLryIA2yJmvHhZLEIEtCYVxGuJesj3vjN8bg9r7udHKHXqnr1KEP0Pv52xgONE+ZRUCLdTXVz1QCmxYETtmyGTKfbv9dg24std5UTtD4crEHjgpaVC+v+6V87S7ZsplVwci+QvRQFg0a3YI1QAABMSCgOAAA=" alt="An Image"></p> <p>所以一个登录有了俩 cookie，别人可以模拟只有 <code>{&quot;userid&quot;:&quot;abb”}</code>，却模拟不了 .sig 的 cookie，因为他不知道你的密钥。</p> <p>但是，总有但是，我不喜欢俩 cookie 咋整？</p> <h2 id="于是有了-jwt"><a href="#于是有了-jwt" class="header-anchor">#</a> 于是有了 JWT</h2> <p>jwt 一般都长这样，三个点连接三个不知道是啥的啥：</p> <div class="language-js extra-class"><pre class="language-js"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span class="token punctuation">.</span>eyJ1c2VyaWQiOiJhIiwiaWF0IjoxNTUxOTUxOTk4fQ<span class="token punctuation">.</span><span class="token number">2</span>jf3kl_uKWRkwjOP6uQRJFqMlwSABcgqqcJofFH5XCo
</code></pre></div><p>他们分别是 Header(头部).Payload(负载).Signature(签名)</p> <p><img src="/assets/img/4.9f1eed04.jpg" alt="An Image"></p> <h4 id="头部用来声明类型和加密类型"><a href="#头部用来声明类型和加密类型" class="header-anchor">#</a> 头部用来声明类型和加密类型</h4> <p><img src="/assets/img/5.8295b95c.png" alt="An Image"></p> <h4 id="负载是一些别的信息"><a href="#负载是一些别的信息" class="header-anchor">#</a> 负载是一些别的信息</h4> <p><img src="/assets/img/6.67c8764e.png" alt="An Image"></p> <h4 id="签名"><a href="#签名" class="header-anchor">#</a> 签名</h4> <p>签名的生成来源于两部分：</p> <ol><li>Base64(header) + . + Base64(payload)</li> <li>配合 <strong>secret</strong> 使用 header 里指定的加密算法对第一部分的组合生成 签名。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>加密算法( Base64(header).Base64(payload), secret )
</code></pre></div><h2 id="认证流程"><a href="#认证流程" class="header-anchor">#</a> 认证流程</h2> <ol><li><p>用户登录时，服务端认证成功后，返回给客户端一个 token</p></li> <li><p>客户端可以将这个 token 保存到本地，localstorage 和 cookie 都可以</p></li> <li><p>后续的接口请求中，需要在请求头中设置 <strong>Authorization</strong> 字段来带上本地保存的 token。Authorization 设置是有固定模式的：<code>Bearer token值</code></p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>Authorization<span class="token operator">:</span> Bearer <span class="token operator">&lt;</span>token<span class="token operator">&gt;</span>
</code></pre></div><ol start="4"><li>服务端会检查请求头中 Authorization 字段是否合法，如果合法则允许当前的请求操作。</li></ol> <h2 id="说点优点"><a href="#说点优点" class="header-anchor">#</a> 说点优点</h2> <p>和 session 模式比较的话。。。</p> <ul><li><p>JWT 是自包含的（内部包含了一些会话信息），因此减少了需要查询数据库的需要</p></li> <li><p>JWT 并不使用 Cookie 的，所以你可以使用任何域名提供你的 API 服务而不需要担心跨域资源共享问题（CORS）</p></li> <li><p>因为用户的状态不再存储在服务端的内存中，所以这是一种无状态的认证机制</p></li></ul> <p>和 cookie 比较的话。。。
当你存储到 cookie 中时，这只需要一个 cookie 就可以了。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/read/jwt/1.html">
        在 Node 中使用 JWT
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a86fb578.js" defer></script><script src="/assets/js/2.f4c76e8f.js" defer></script><script src="/assets/js/5.7803e6c7.js" defer></script>
  </body>
</html>
