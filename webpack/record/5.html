<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目模块引用引发的记录 | 行也安然，坐也安然</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="韩志臻的blog">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.a86fb578.js" as="script"><link rel="preload" href="/assets/js/2.f4c76e8f.js" as="script"><link rel="preload" href="/assets/js/4.03ca31d0.js" as="script"><link rel="prefetch" href="/assets/js/10.c61de724.js"><link rel="prefetch" href="/assets/js/100.4d2d0254.js"><link rel="prefetch" href="/assets/js/11.5946abfa.js"><link rel="prefetch" href="/assets/js/12.f35e3c14.js"><link rel="prefetch" href="/assets/js/13.b07a3d91.js"><link rel="prefetch" href="/assets/js/14.bce4ea6a.js"><link rel="prefetch" href="/assets/js/15.22ab3510.js"><link rel="prefetch" href="/assets/js/16.532528f4.js"><link rel="prefetch" href="/assets/js/17.6547aa4e.js"><link rel="prefetch" href="/assets/js/18.fccb4247.js"><link rel="prefetch" href="/assets/js/19.cf7baf86.js"><link rel="prefetch" href="/assets/js/20.80bddd98.js"><link rel="prefetch" href="/assets/js/21.9dd6f94b.js"><link rel="prefetch" href="/assets/js/22.df40fa6b.js"><link rel="prefetch" href="/assets/js/23.d381164b.js"><link rel="prefetch" href="/assets/js/24.23eccce1.js"><link rel="prefetch" href="/assets/js/25.675a5dd3.js"><link rel="prefetch" href="/assets/js/26.134e7b03.js"><link rel="prefetch" href="/assets/js/27.44100860.js"><link rel="prefetch" href="/assets/js/28.51c5575c.js"><link rel="prefetch" href="/assets/js/29.2bb6682f.js"><link rel="prefetch" href="/assets/js/3.dc71286f.js"><link rel="prefetch" href="/assets/js/30.675b9b1e.js"><link rel="prefetch" href="/assets/js/31.12bfff40.js"><link rel="prefetch" href="/assets/js/32.c6ed9587.js"><link rel="prefetch" href="/assets/js/33.5dd439a5.js"><link rel="prefetch" href="/assets/js/34.0d93fa0b.js"><link rel="prefetch" href="/assets/js/35.f16b6751.js"><link rel="prefetch" href="/assets/js/36.84da4777.js"><link rel="prefetch" href="/assets/js/37.f584e26a.js"><link rel="prefetch" href="/assets/js/38.22809fd4.js"><link rel="prefetch" href="/assets/js/39.87565ecd.js"><link rel="prefetch" href="/assets/js/40.99aa2710.js"><link rel="prefetch" href="/assets/js/41.ffdc7e56.js"><link rel="prefetch" href="/assets/js/42.c8035223.js"><link rel="prefetch" href="/assets/js/43.e2214561.js"><link rel="prefetch" href="/assets/js/44.0451c7eb.js"><link rel="prefetch" href="/assets/js/45.c7c5d317.js"><link rel="prefetch" href="/assets/js/46.c515681e.js"><link rel="prefetch" href="/assets/js/47.a8782c24.js"><link rel="prefetch" href="/assets/js/48.8f8216de.js"><link rel="prefetch" href="/assets/js/49.c62cf464.js"><link rel="prefetch" href="/assets/js/5.7803e6c7.js"><link rel="prefetch" href="/assets/js/50.d368641c.js"><link rel="prefetch" href="/assets/js/51.2d563851.js"><link rel="prefetch" href="/assets/js/52.cd107f70.js"><link rel="prefetch" href="/assets/js/53.947bfe0c.js"><link rel="prefetch" href="/assets/js/54.3fd47ce6.js"><link rel="prefetch" href="/assets/js/55.54035b51.js"><link rel="prefetch" href="/assets/js/56.4b338e06.js"><link rel="prefetch" href="/assets/js/57.3dc90d2d.js"><link rel="prefetch" href="/assets/js/58.d8c80a8c.js"><link rel="prefetch" href="/assets/js/59.3ba9b603.js"><link rel="prefetch" href="/assets/js/6.67d8c318.js"><link rel="prefetch" href="/assets/js/60.7de94339.js"><link rel="prefetch" href="/assets/js/61.17ac02b3.js"><link rel="prefetch" href="/assets/js/62.34d201e5.js"><link rel="prefetch" href="/assets/js/63.44d78f9a.js"><link rel="prefetch" href="/assets/js/64.b6341398.js"><link rel="prefetch" href="/assets/js/65.74297b02.js"><link rel="prefetch" href="/assets/js/66.e27db92d.js"><link rel="prefetch" href="/assets/js/67.08815a96.js"><link rel="prefetch" href="/assets/js/68.ab305a80.js"><link rel="prefetch" href="/assets/js/69.244199d4.js"><link rel="prefetch" href="/assets/js/7.6ef23db2.js"><link rel="prefetch" href="/assets/js/70.16c8374a.js"><link rel="prefetch" href="/assets/js/71.32994fc5.js"><link rel="prefetch" href="/assets/js/72.cd5e5614.js"><link rel="prefetch" href="/assets/js/73.95a35acc.js"><link rel="prefetch" href="/assets/js/74.45311324.js"><link rel="prefetch" href="/assets/js/75.5bcdecc4.js"><link rel="prefetch" href="/assets/js/76.524ebead.js"><link rel="prefetch" href="/assets/js/77.b68128ca.js"><link rel="prefetch" href="/assets/js/78.24beb1ca.js"><link rel="prefetch" href="/assets/js/79.086f08d5.js"><link rel="prefetch" href="/assets/js/8.46452597.js"><link rel="prefetch" href="/assets/js/80.05f17557.js"><link rel="prefetch" href="/assets/js/81.892e81b9.js"><link rel="prefetch" href="/assets/js/82.6eed85e0.js"><link rel="prefetch" href="/assets/js/83.55540564.js"><link rel="prefetch" href="/assets/js/84.df22c114.js"><link rel="prefetch" href="/assets/js/85.082bbedf.js"><link rel="prefetch" href="/assets/js/86.7d3cb835.js"><link rel="prefetch" href="/assets/js/87.53fbac2b.js"><link rel="prefetch" href="/assets/js/88.01455844.js"><link rel="prefetch" href="/assets/js/89.f86e57f5.js"><link rel="prefetch" href="/assets/js/9.ef8fa7e5.js"><link rel="prefetch" href="/assets/js/90.923a5b8a.js"><link rel="prefetch" href="/assets/js/91.7a019c2a.js"><link rel="prefetch" href="/assets/js/92.397eea0f.js"><link rel="prefetch" href="/assets/js/93.059d7112.js"><link rel="prefetch" href="/assets/js/94.84e5aa9d.js"><link rel="prefetch" href="/assets/js/95.0f3904d2.js"><link rel="prefetch" href="/assets/js/96.05b74007.js"><link rel="prefetch" href="/assets/js/97.fab30f76.js"><link rel="prefetch" href="/assets/js/98.fe86df06.js"><link rel="prefetch" href="/assets/js/99.68d7a172.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">行也安然，坐也安然</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据存储" class="dropdown-title"><span class="title">数据存储</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据存储" class="mobile-dropdown-title"><span class="title">数据存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db/mysql/0.html" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/db/redis/0.html" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/db/mongodb/0.html" class="nav-link">
  MongoDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/common/0.html" class="nav-link">
  vue 常见功能
</a></li><li class="dropdown-item"><!----> <a href="/vue/v3/0.html" class="nav-link">
  一个项目的搭建
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="webpack" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/record/0.html" class="nav-link">
  记录
</a></li><li class="dropdown-item"><!----> <a href="/webpack/practice/0.html" class="nav-link">
  实践
</a></li></ul></div></div><div class="nav-item"><a href="/read/jwt/0.html" class="nav-link">
  Reading
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          NPM包使用记录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/npm/log4js.html" class="nav-link">
  Log4js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/markmap.html" class="nav-link">
  Markmap.js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/react-pdf.html" class="nav-link">
  React-pdf
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据存储" class="dropdown-title"><span class="title">数据存储</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据存储" class="mobile-dropdown-title"><span class="title">数据存储</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db/mysql/0.html" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/db/redis/0.html" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/db/mongodb/0.html" class="nav-link">
  MongoDB
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue/common/0.html" class="nav-link">
  vue 常见功能
</a></li><li class="dropdown-item"><!----> <a href="/vue/v3/0.html" class="nav-link">
  一个项目的搭建
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="webpack" class="dropdown-title"><span class="title">webpack</span> <span class="arrow down"></span></button> <button type="button" aria-label="webpack" class="mobile-dropdown-title"><span class="title">webpack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/webpack/record/0.html" class="nav-link">
  记录
</a></li><li class="dropdown-item"><!----> <a href="/webpack/practice/0.html" class="nav-link">
  实践
</a></li></ul></div></div><div class="nav-item"><a href="/read/jwt/0.html" class="nav-link">
  Reading
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          NPM包使用记录
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/projects/npm/log4js.html" class="nav-link">
  Log4js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/markmap.html" class="nav-link">
  Markmap.js
</a></li><li class="dropdown-subitem"><a href="/projects/npm/react-pdf.html" class="nav-link">
  React-pdf
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/webpack/record/0" class="sidebar-heading clickable open"><span>记录</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/webpack/record/0.html" class="sidebar-link">require.context 的使用</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="项目模块引用引发的记录"><a href="#项目模块引用引发的记录" class="header-anchor">#</a> 项目模块引用引发的记录</h1> <p>之所以是引发的记录而不是思考，是因为到现在为止，我也不知道该思考什么，所以就先记录过程。</p> <h2 id="import-引入报错了"><a href="#import-引入报错了" class="header-anchor">#</a> import 引入报错了？</h2> <p>之前在项目中使用将 markdown 语法转成思维导图的 npm 包 <strong>markmap.js</strong> 时，我只是执行了:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Transformer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;markmap-lib&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> transformer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transformer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>就碰到一大堆的相似的报错，有那么一大堆：
<img src="/assets/img/0.3905abc7.png" alt="An Image"></p> <p>我摘取了其中的一个：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>ERROR <span class="token keyword">in</span> ./node_modules/markmap-lib/dist/index.mjs <span class="token number">49</span>:16-20
Can<span class="token string">'t import the named export '</span>Hook' from non EcmaScript module <span class="token punctuation">(</span>only default <span class="token builtin class-name">export</span> is available<span class="token punctuation">)</span>
 @ ./src/pages/chatAi/components/chatPage/components/mindup/index.tsx
 @ ./src/pages/chatAi/components/chatPage/components/index.ts
 @ ./src/pages/chatAi/components/previewPage/index.tsx
 @ ./src/pages/chatAi/components/layoutRight/index.tsx
 @ ./src/pages/chatAi/chatAi.tsx
 @ ./src/pages/chatAi/index.tsx
</code></pre></div><p>这个报错的意思就是在组件 mindup 代码执行时，出现了正在尝试<strong>用 import 的方式从一个并非 ECMAScript 模块中导入了一个名字是 Hook 的模块</strong>。</p> <p>在 ECMAScript(ES)模块中，可以通过 import 引入的模块，只能通过两种方式导出模块内容：</p> <ul><li>默认导出(default export)，也就是常用的 <code>export default xxx</code></li> <li>命名导出(named export)，常用的有 <code>export const fn = () =&gt; {}</code> 或者 <code>export const A = xxx</code></li></ul> <p>但是我项目里全都是使用的 <code>import xxx from xxxx</code> 的方式导入的模块，为啥到了它 markmap 就不行了呢？</p> <p>难道天将降大任于斯人也？</p> <p>这种模块和模块之间的疑问，我现在觉得最好的方法，就是用看起来最蠢的方法：<strong>一点一点的对比两个依赖包</strong>。</p> <p>于是我扒开了项目里引用过的还正常的依赖： <strong>lodash-es</strong></p> <h2 id="哪个是引入模块的入口"><a href="#哪个是引入模块的入口" class="header-anchor">#</a> 哪个是引入模块的入口？</h2> <p>展示一个从 lodash-es 中引用 throttle 模块的方式:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> throttle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;lodash-es&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>第一时间有两个结论：</p> <ol><li>lodash-es 导出 throttle 的方式是 <strong>命名导出(named export)</strong> 方式，至少得是个 <code>export const throttle = () =&gt; {}</code></li> <li><code>from lodash-es</code> 应该是 <code>from lodash-es/index.js</code> 吧？</li></ol> <p>但是打开 <code>lodash-es</code> 的 node_modules 依赖包后，没有 index.js 只有 <code>indexOf.js</code>，lodash-es 文件夹下，全是各个模块。</p> <p><img src="data:image/png;base64,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" alt="An Image"></p> <p>没错，我觉着你看到了我画红框的那个文件了：<strong>package.json</strong>。</p> <p>打开它来看几个字段：</p> <p><img src="/assets/img/2.7715c4e1.png" alt="An Image"></p> <h3 id="字段-main"><a href="#字段-main" class="header-anchor">#</a> 字段 main</h3> <p>它指向的是 <strong>CommonJs</strong> 引入方式导入程序的入口文件，也就是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> throttle <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;lodash-es&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="字段-module"><a href="#字段-module" class="header-anchor">#</a> 字段 module</h3> <p>它指向 <strong>ESModule</strong> 引入方式导入程序的入口文件，也就是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> throttle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;lodash-es&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="字段-type"><a href="#字段-type" class="header-anchor">#</a> 字段 type</h3> <p><code>type</code> 字段新增与 node@12.0.0 版本，于 v13.12.0，v12.17.0 取消标记 --experimental-modules。</p> <p><strong>值：<code>module</code> | <code>commonjs</code>，没有默认值，不设置 <code>type</code> 字段时 .js 文件被视为 CommonJS。</strong></p> <h4 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h4> <p>type 字段决定了 Node.js 中用到的所有 .js 文件的模块格式，这些 .js 文件将包含 package.json 的文件夹作为父级文件。</p> <p>当最近的父级文件夹中的 package.json 中包含了 <code>type: 'module'</code> 的配置时，所有的 .js 文件都被视作 ES 模块进行加载。</p> <p>在搜索 <code>package.json</code> 文件时，如果最近的 <code>package.json</code> 就定义在当前的文件夹中，或者该文件夹的父文件夹中，等等往大了类推，直到 node_modules 或者 根文件夹。</p> <p>如果最近的 package.json 缺少 <code>type</code> 字段，或者包含 <code>type: 'commonjs'</code>，则 .js 文件被视为 CommonJS。如果到达根卷目录都没有找到 <code>package.json</code>，则 .js 文件被视为 CommonJS。</p> <p>如果最近的 package.json 包含 <code>type: 'module'</code>，则 .js 文件的 import 语句被视为 ES 模块。</p> <p>无论 &quot;type&quot; 字段的值如何，.mjs 文件始终被视为 ES 模块，而 .cjs 文件始终被视为 CommonJS。</p> <h4 id="type-module-时"><a href="#type-module-时" class="header-anchor">#</a> type: 'module' 时</h4> <p>此时的 .js 文件被视为 EsModule 文件，CommonJs 的文件就需要声明称 <code>.cjs</code> 的后缀，如下：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.cjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./unstyled&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/unstyled.d.ts&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可以省略，但不建议</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/unstyled.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/unstyled.cjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./*&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./*&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><h4 id="type-commonjs-或-没有设置-type-时"><a href="#type-commonjs-或-没有设置-type-时" class="header-anchor">#</a> type: 'commonjs' 或 没有设置 type 时</h4> <p>此时 .js 将被视为 CmmonJs，并且我们需要将 EsModule 文件通常需要显示的声明为 <code>.mjs</code> 或 <code>.esm.js</code>。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...<span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.mjs&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.d.ts&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.mjs&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./unstyled&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/unstyled.d.ts&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 可以省略，但不建议</span>
      <span class="token property">&quot;import&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/unstyled.mjs&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/unstyled.js&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./*&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./*&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><h3 id="回到-lodash-es-入口问题"><a href="#回到-lodash-es-入口问题" class="header-anchor">#</a> 回到 lodash-es 入口问题</h3> <p>通过 lodash-es 的 package.json 文件，我们就知道入口文件是什么了，虽然它的 module 和 main 字段是一个文件。无所谓，我们会见到不同的。</p> <p>来看看 lodash-es.js 文件，至少我们的第一个结论没毛病，它的确是 <strong>命名导出(named export) 的方式</strong>。
<img src="/assets/img/3.0a724dfb.png" alt="An Image"></p> <p>顺便把 <code>throttle</code> 源码放这里，留着以后看：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> leading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    trailing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> func <span class="token operator">!=</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token constant">FUNC_ERROR_TEXT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    leading <span class="token operator">=</span> <span class="token string">&quot;leading&quot;</span> <span class="token keyword">in</span> options <span class="token operator">?</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>leading <span class="token operator">:</span> leading<span class="token punctuation">;</span>
    trailing <span class="token operator">=</span> <span class="token string">&quot;trailing&quot;</span> <span class="token keyword">in</span> options <span class="token operator">?</span> <span class="token operator">!</span><span class="token operator">!</span>options<span class="token punctuation">.</span>trailing <span class="token operator">:</span> trailing<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">debounce</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    leading<span class="token operator">:</span> leading<span class="token punctuation">,</span>
    maxWait<span class="token operator">:</span> wait<span class="token punctuation">,</span>
    trailing<span class="token operator">:</span> trailing<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> throttle<span class="token punctuation">;</span>
</code></pre></div><p><strong>那么问题来了：markmap.js 的是怎么回事呢？</strong></p> <h3 id="markmap-js-的入口们"><a href="#markmap-js-的入口们" class="header-anchor">#</a> Markmap.js 的入口们</h3> <h4 id="markmap-lib-js-的入口"><a href="#markmap-lib-js-的入口" class="header-anchor">#</a> markmap-lib.js 的入口</h4> <p>同样的套路来看看 <code>markmap-lib.js</code> 的 <code>package.json</code> 文件内容：</p> <p><img src="/assets/img/4.32c1e83d.png" alt="An Image"></p> <p>它告诉我们 import 引入的资源文件是：<code>dist/index.mjs</code> 文件，来看看哪个文件是怎么暴露模块的。</p> <p><img src="/assets/img/5.d294298c.png" alt="An Image"></p> <p><code>export { Transform }</code> 方式导出，完全没有问题。那么为啥给我报错了？再看一下报错信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">ERROR</span> <span class="token keyword">in</span> <span class="token punctuation">.</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>markmap<span class="token operator">-</span>lib<span class="token operator">/</span>dist<span class="token operator">/</span>index<span class="token punctuation">.</span>mjs <span class="token number">49</span><span class="token operator">:</span><span class="token number">16</span><span class="token operator">-</span><span class="token number">20</span>
Can<span class="token string">'t import the named export '</span>Hook' from non EcmaScript <span class="token function">module</span> <span class="token punctuation">(</span>only <span class="token keyword">default</span> <span class="token keyword">export</span> is available<span class="token punctuation">)</span>
</code></pre></div><p><strong>Hook</strong> 模块是谁，全局搜索后，发现是 <code>markmap-lib.js</code> 从 <code>markmap-common.js</code> 中引入的模块：</p> <p><img src="/assets/img/6.bb6813d4.png" alt="An Image"></p> <h4 id="markmap-common-js-的入口"><a href="#markmap-common-js-的入口" class="header-anchor">#</a> markmap-common.js 的入口</h4> <p><img src="/assets/img/7.433f59a0.png" alt="An Image"></p> <p>从 <code>markmap-common.js</code> 的 package.json 文件中我们看到 module 对应的是 <code>dist/index.mjs</code>。</p> <p>而 <code>dist/index.mjs</code> 文件中的内容也如约是 <code>export</code> 导出形式：
<img src="/assets/img/8.99f59918.png" alt="An Image"></p> <p>但是，此时 <code>markmap-lib.js</code> 实际导入 Hook 模块时引用的文件却是清一色 <code>export.xxx</code> 导出模式的 <code>dist/index.js</code> 文件：
<img src="/assets/img/9.cb3b5366.png" alt="An Image"></p> <p>这是为啥呢？</p> <p>难道，天将降大任于斯人也？</p> <p>啊，不对，难道天将降大 bug 于这个库？</p> <p>那 &quot;人家的程序员&quot; 是怎么解决的？🙄🙄🙄</p> <p>鲁树人说，啊呸～</p> <p>周迅说，啊呸～</p> <p>反正有人说：<strong>方案就像海绵里的水，只要老板挤，就会有的。</strong></p> <h3 id="来一场倒序的复盘"><a href="#来一场倒序的复盘" class="header-anchor">#</a> 来一场倒序的复盘</h3> <h4 id="_1-markmap-lib-js-为啥要引用-markmap-common-js-的-index-js-文件"><a href="#_1-markmap-lib-js-为啥要引用-markmap-common-js-的-index-js-文件" class="header-anchor">#</a> 1. markmap-lib.js 为啥要引用 markmap-common.js 的 index.js 文件？</h4> <p>首先，它引入的方式是 <code>import { Hook, ... } from 'markmap-common'</code></p> <p>默认情况下，我们都认为应该是 index.js 文件没错。</p> <p>但是，markmap-common.js 也同时设置了 main 和 module 指向了不同的模块入口文件。</p> <p><font color="red"><strong>为什么 markmap-lib.js 引入的偏偏是 index.js 文件呢？</strong></font></p> <p>根据【<a href="/webpack/record/6.html#type-字段">type</a>】 知识点</p> <p>是因为 markmap-common.js 最近的 package.json 中没有设置 type，那么默认它就是一个 CommonJs 模块，所以引用的是 <code>index.js</code>。</p> <p>这理论应该是凑上了，坑了坑～</p> <h4 id="_2-为什么从-markmap-lib-js-中导入-transformer-模块时会自动引入-index-mjs-文件"><a href="#_2-为什么从-markmap-lib-js-中导入-transformer-模块时会自动引入-index-mjs-文件" class="header-anchor">#</a> 2. 为什么从 markmap-lib.js 中导入 Transformer 模块时会自动引入 index.mjs 文件？</h4> <p>这估计要感谢它的 package.json 中设置的 exports 字段了。</p> <h3 id="字段-exports"><a href="#字段-exports" class="header-anchor">#</a> 字段 exports</h3> <p>exports 字段个人理解是用来定义模块的导出规则的。可以理解成<strong>它是路径的映射，也是模块引用的说明</strong>。</p> <p>来看看 markmap-lib.js 的 package.json 文件内容：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/index.mjs&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;unpkg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/browser/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;jsdelivr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dist/browser/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exports&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;.&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./types/index.d.ts&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/browser/index.mjs&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.js&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./dist/index.mjs&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;./package.json&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./package.json&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中的 exports 定义了几个信息：</p> <ol><li><strong>require</strong> 引入的方式入口路径是 <code>./dist/index.js</code> 文件</li> <li><strong>default</strong> 表示当你 <code>import xx from 'markmap-lib'</code> 时，默认导入的文件就是 <code>index.mjs</code>，这就找到原因了。</li></ol> <h2 id="该如何解决呢"><a href="#该如何解决呢" class="header-anchor">#</a> 该如何解决呢？</h2> <h3 id="resolve-alias-方案"><a href="#resolve-alias-方案" class="header-anchor">#</a> Resolve.alias 方案</h3> <p>首先是 webpack 配置中的 resolve 配置。它是用来设置模块如何被解析的。</p> <p>而 <code>resolve.alias</code> 配置在项目开发时，大多是用来给 <code>import</code> 或 <code>require</code> 引入的包来配置别名的。最常见的就是关于 src 文件夹的配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//....</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;@src&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>除了配置别名外，<code>resolve.alias</code> 还可以指定模块引入的具体文件和路径，其实原理就是针对相应的模块做了一个别名处理。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//....</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 注意：__dirname 之后的内容根据自己项目的结构目录进行调整</span>
      <span class="token string">&quot;@src&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string">&quot;markmap-common&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
        __dirname<span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/markmap-common/dist/index.mjs&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      remarkable<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
        __dirname<span class="token punctuation">,</span>
        <span class="token string">&quot;./node_modules/remarkable/dist/esm/index.js&quot;</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>上面调整完，报错就不见了。但是，可以看到，我除了配置了 <code>markmap-common</code> 还配置了 <code>remarkable</code>，这两个都是在 <code>markmap-lib</code>中使用的，<a href="/webpack/record/6.html#markmap-js-的入口们">见 Markmap.js 的入口们第四个图</a>。</p> <p>很明显，这种配置方案很复杂，如果有多个呢？如果 <code>markmap-common</code> 中还有更深此次的引入呢？</p> <p>这种方案很明显不够通用。</p> <h3 id="更改-type-值"><a href="#更改-type-值" class="header-anchor">#</a> 更改 type 值</h3> <p>其实这是我的第一个反应，但是很明显由于各种项目现状是不行的。</p> <p>其次，也有别的模块由于这种更改反而出现了 require 引入导致了报错，反正很难受。</p> <h3 id="使用-require-方法引入"><a href="#使用-require-方法引入" class="header-anchor">#</a> 使用 require 方法引入</h3> <p>思路是这样的，假如我使用 require 方法引入 <code>markmap-lib</code>。</p> <p>根据它的 <code>package.json</code> 中的 <code>exports</code> 配置，我需要导入的是 <code>markmap-lib/dist/index.js</code> 文件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 要显示的声明自己导入的就是 markmap-list/dist/index 文件</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Transformer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;markmap-lib/dist/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这个文件的内部通过 <code>require</code> 方法引入的别的包。而项目本身已经设置了 <code>type: 'commonjs'</code>，这正好吻合。
<img src="/assets/img/10.33cc4213.png" alt="An Image"></p> <p>接下俩就是配置项目中除了 import 引用之外，还可以同时使用 require 引用了。</p> <p>好在我只是在项目写了一下 require 就有了提醒，按照提醒配置就成功了。不知道是不是因为项目是 ts 的原因。
<img src="/assets/img/11.10b0a95b.png" alt="An Image"></p> <p>这种方式感觉后面还有坑，但是目前没踩到，就算了。碰到了，再填吧～</p> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ol><li><a href="https://juejin.cn/post/7212436135287504954" target="_blank" rel="noopener noreferrer">一文彻底搞懂 package.json 中的 exports,main,module,type<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/7032278473389539365" target="_blank" rel="noopener noreferrer">关于 package.json 中 type 属性的含义<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/concepts/module-resolution/#resolving-rules-in-webpack" target="_blank" rel="noopener noreferrer">Webpack 官网-模块解析篇章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/configuration/resolve/#resolvealias" target="_blank" rel="noopener noreferrer">webpack 官网-Resolve 篇章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nodejs.cn/dist/latest-v20.x/docs/api/packages.html#type" target="_blank" rel="noopener noreferrer">module/package 包模块<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><strong>最后感谢<a href="https://yiyan.baidu.com/" target="_blank" rel="noopener noreferrer">文心一言<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>不停给我普及各种不懂的东西。o(^▽^)o</strong></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a86fb578.js" defer></script><script src="/assets/js/2.f4c76e8f.js" defer></script><script src="/assets/js/4.03ca31d0.js" defer></script>
  </body>
</html>
